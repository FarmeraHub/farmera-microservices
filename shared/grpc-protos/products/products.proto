syntax = "proto3";

package farmera.products;

import "common/types.proto";
import "common/enums.proto";
import "common/pagination.proto";
// import "common/errors.proto";
option go_package = "github.com/farmera/grpc-protos/products";

// Products service definition
service ProductsService {
  // Product management
  rpc CreateProduct(CreateProductRequest) returns (CreateProductResponse);
  rpc GetProduct(GetProductRequest) returns (GetProductResponse);
  rpc GetListProducts(GetListProductsRequest) returns (GetListProductsResponse);
  rpc UpdateProduct(UpdateProductRequest) returns (UpdateProductResponse);
  rpc DeleteProduct(DeleteProductRequest) returns (DeleteProductResponse);
  rpc SearchProducts(SearchProductsRequest) returns (SearchProductsResponse);
  //rpc GetProductsByFarm(GetProductsByFarmRequest) returns (GetProductsByFarmResponse);
  //rpc GetProductsByCategory(GetProductsByCategoryRequest) returns (GetProductsByCategoryResponse);
  //rpc UpdateProductStatus(UpdateProductStatusRequest) returns (UpdateProductStatusResponse);
  
  // Farm management
  rpc CreateFarm(CreateFarmRequest) returns (CreateFarmResponse);
  rpc VerifyFarm(stream VerifyFarmRequest) returns (VerifyFarmResponse);
  rpc GetFarm(GetFarmRequest) returns (GetFarmResponse);
  rpc UpdateFarm(UpdateFarmRequest) returns (UpdateFarmResponse);
  rpc ListFarms(ListFarmsRequest) returns (ListFarmsResponse);
  //rpc GetFarmsByLocation(GetFarmsByLocationRequest) returns (GetFarmsByLocationResponse);
  rpc GetFarmByUser(GetFarmByUserRequest) returns (GetFarmByUserResponse);
  rpc UpdateFarmStatus(UpdateFarmStatusRequest) returns (UpdateFarmStatusResponse);

  // Category management
  rpc CreateCategory(CreateCategoryRequest) returns (CreateCategoryResponse);
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  //rpc UpdateCategory(UpdateCategoryRequest) returns (UpdateCategoryResponse);
  //rpc DeleteCategory(DeleteCategoryRequest) returns (DeleteCategoryResponse);
  //rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);
  rpc GetCategoryTree(GetCategoryTreeRequest) returns (GetCategoryTreeResponse);
  //rpc GetAllCategoryWithSubcategory(GetAllCategoryWithSubcategoryRequest) returns (GetAllCategoryWithSubcategoryResponse);

  //Subcategory
  rpc CreateSubcategory(CreateSubcategoryRequest) returns (CreateSubcategoryResponse);
  rpc GetSubcategory(GetSubcategoryRequest) returns (GetSubcategoryResponse);

  
  // Review management
  rpc CreateReview(CreateReviewRequest) returns (CreateReviewResponse);
  rpc CreateReply(CreateReplyRequest) returns (CreateReplyResponse);
  rpc UpdateReview(UpdateReviewRequest) returns (UpdateReviewResponse);
  rpc UpdateReply(UpdateReplyRequest) returns (UpdateReplyResponse);
  rpc DeleteReview(DeleteReviewRequest) returns (DeleteReviewResponse);
  rpc DeleteReply(DeleteReplyRequest) returns (DeleteReplyResponse);
  rpc ApproveReview(ApproveReviewRequest) returns (ApproveReviewResponse);
  //rpc ListReviews(ListReviewsRequest) returns (ListReviewsResponse);
  
  // Process tracking
  rpc CreateProcess(CreateProcessRequest) returns (CreateProcessResponse);
  rpc GetProcess(GetProcessRequest) returns (GetProcessResponse);
  rpc ListProcesses(ListProcessesRequest) returns (ListProcessesResponse);  
}

// ======================================Product==========================================
message Product {
  int32 product_id = 1;
  string product_name = 2;
  string description = 3;
  int32 price_per_unit = 4;
  string unit = 5;
  int32 stock_quantity = 6;
  double weight = 7;
  repeated string image_urls = 8;
  repeated string video_urls = 9;
  farmera.common.ProductStatus status = 10;
  farmera.common.Timestamp created = 11;
  farmera.common.Timestamp updated = 12;
  optional SubcategoryList subcategory_details = 13;
  double average_rating = 14;
  int32 total_sold = 15;
  string farm_id = 16;
}

message SubcategoryList {
  repeated Subcategory subcategories = 1;
}

message CreateProductRequest {
  string farm_id = 1;
  string product_name = 2;
  string description = 3;
  farmera.common.Money price_per_unit = 4;
  farmera.common.Unit unit = 5;
  int32 stock_quantity = 6;
  repeated int32 subcategory_ids = 7;
  repeated string image_urls = 8;
  repeated string video_urls = 9;
  bool is_organic = 10;
  bool is_seasonal = 11;
  farmera.common.Timestamp harvest_date = 12;
  farmera.common.Timestamp expiry_date = 13;
  repeated string tags = 14;
  string sku = 15;
}

message CreateProductResponse {
  Product product = 1;
}

message GetProductRequest {
  int32 product_id = 1;
  optional bool include_farm = 2;
}

message GetProductResponse {
  Product product = 1;
}

message GetListProductsRequest{
  repeated ProductRequest products = 1;
}

message GetListProductsResponse{
  repeated ProductResponse products_found = 1; 
}

message ProductRequest{
  int32 product_id = 1;
  optional string product_name = 2;
  optional string farm_id = 3;
}

message ProductResponse {
  Product product = 1;
  Farm farm = 2;
}

message UpdateProductRequest {
  int32 product_id = 1;
  optional string product_name = 2;
  optional string description = 3;
  optional farmera.common.Money price_per_unit = 4;
  optional int32 stock_quantity = 5;
  repeated string image_urls = 6;
  repeated string video_urls = 7;
  repeated string tags = 8;
  optional bool is_organic = 9;
  optional farmera.common.Timestamp expiry_date = 10;
}

message UpdateProductResponse {
  Product product = 1;
}

message DeleteProductRequest {
  int32 product_id = 1;
  string reason = 2;
}

message DeleteProductResponse {
  bool success = 1;
}

message SearchProductsRequest {
  string query = 1;
  farmera.common.PaginationRequest pagination = 2;
  repeated string filters = 3; // "organic", "local", "seasonal", etc.
  optional farmera.common.GeoLocation location = 4;
  optional double max_distance_km = 5;
}

message SearchProductsResponse {
  repeated Product products = 1;
  farmera.common.PaginationResponse pagination = 2;
  repeated string suggested_queries = 3;
}

// ==================================Farm==================================
// Farm
message Farm {
  string farm_id = 1;
  string farm_name = 2;
  string description = 3;
  string user_id = 4; // User ID of the farm owner
  string email = 5;
  string phone = 6;
  string avatar_url = 7;
  repeated string profile_image_urls = 8;
  repeated string certificate_img_urls = 9 ;
  string tax_number = 10;
  farmera.common.FarmStatus status = 11;
  farmera.common.Timestamp created = 12;
  farmera.common.Timestamp updated = 13;
  optional Address address = 14;
  optional Identification identification = 15;
}

message Identification {
  string id = 1;
  farmera.common.IdentificationStatus status = 2;
  farmera.common.IdentificationMethod method = 3;
  string nationality = 4;
  string id_number = 5;
  string full_name = 6;
}

message AddressGHN {
 int32 id = 1;
 int32 province_id = 2;
 int32 district_id = 3;
 string ward_code = 4;
}

message Address {
  int32 address_id = 1;
  string city = 2;
  string district = 3;
  string ward = 4;
  string street = 5;
  string coordinate = 6;
  farmera.common.Timestamp created = 7;
  string farm_id = 8; 
  optional AddressGHN address_ghn = 9;
}

message CreateFarmRequest {
  string farm_name = 1;
  string description = 2;
  string email = 3;
  string phone = 4;
  string tax_number = 5;
  string city = 6;
  string district = 7;
  string ward = 8;
  string street = 9;
  string coordinate = 10;
  string user_id = 11;
}

message CreateFarmResponse {
  Farm farm = 1;
}

message VerifyFarmRequest {
  oneof test_oneof {
    VerifyFileMetadata meta = 2;
    ImageChunk chunk = 1;
  }
}

message VerifyFileMetadata{
  string file_name = 1;
  string file_type = 2;
  int64 total_size = 3;
  string file_id = 4;
  string farm_id = 5; 
  string mime_type = 6;
  string user_id = 7;
}

message ImageChunk {
  string file_id = 1;
  bytes data = 2;
}

message VerifyFarmResponse {
  Farm farm = 1;
  farmera.common.VerifyStatusCode status = 2;
  optional string message = 3;
}

message GetFarmRequest {
  string farm_id = 1;
}

message GetFarmResponse {
  Farm farm = 1;
}

message UpdateFarmRequest {
  string farm_id = 1;
  optional string farm_name = 2;
  optional string description = 3;
}

message UpdateFarmResponse {
  Farm farm = 1;
}

message ListFarmsRequest {
  farmera.common.PaginationRequest pagination = 1;
  repeated farmera.common.SortOption sort = 2;
  optional bool verified_only = 3;
  optional bool active_only = 4;
  optional string search_query = 5;
  optional farmera.common.GeoLocation location_filter = 6;
}

message ListFarmsResponse {
  repeated Farm farms = 1;
  farmera.common.PaginationResponse pagination = 2;
}

message GetFarmByUserRequest{
  string user_id = 1;
}

message GetFarmByUserResponse {
  Farm farm = 1;
}

message UpdateFarmStatusRequest{
  string farm_id = 1;
  string user_id = 2;
  string status = 3;
  optional string reason = 4;
 }

message UpdateFarmStatusResponse{
  Farm farm = 1;
}

// ======================================Category============================================
// Category message definition
message Category {
  int32 category_id = 1;
  string name = 2;
  optional string description = 3;
  string image_url = 4;
  farmera.common.Timestamp created = 5;
}

message Subcategory {
  int32 subcategory_id = 1;
  string name = 2;
  optional string description = 3;
  farmera.common.Timestamp created = 4;
  Category category = 5;
}

message SubcategoryLite  {
  int32 subcategory_id = 1;
  string name = 2;
  optional string description = 3;
  farmera.common.Timestamp created = 4;
}

message CreateCategoryRequest {
  string name = 1;
  optional string description = 2;
  optional string category_icon_url = 3;
}

message CreateCategoryResponse {
  Category category = 1;
}

message GetCategoryRequest {
  int32 category_id = 1;
}

message GetCategoryResponse {
  Category category = 1;
}

message GetCategoryTreeRequest {
  int32 category_id = 1;
}

message GetCategoryTreeResponse {
  Category category = 1;
  repeated SubcategoryLite sublist = 2;
}

message CreateSubcategoryRequest {
  string name = 1;
  optional string description = 2;
  int32 category_id = 3;
}

message CreateSubcategoryResponse{
  Subcategory subcategory = 1;
}

message GetSubcategoryResponse{
  Subcategory subcategory = 1;
}

message GetSubcategoryRequest {
  int32 subcategory_id = 1;
}

// ====================================Review=============================================
message Review {
  int32 review_id = 1;
  int32 product_id = 2;
  string user_id = 3;
  int32 rating = 4; // 1-5 stars
  string comment = 5;
  optional farmera.common.StringList images_urls = 6;
  optional farmera.common.StringList video_urls = 7;
  bool seller_approved = 8;
  farmera.common.Timestamp created = 9;
  int32 order_detail_id = 10; // Reference to purchase order
  optional ReplyList replies = 11;
}

message ReviewReply {
  int32 id = 1;
  string user_id = 2;
  string reply = 3;
  farmera.common.Timestamp created = 4;
}

message ReplyList {
  repeated ReviewReply replies = 1;
}

message CreateReviewRequest {
  int32 product_id = 1;
  string user_id = 2;
  int32 rating = 3;
  string comment = 5;
  optional farmera.common.StringList image_urls = 6;
  optional farmera.common.StringList video_urls = 7;
}

message CreateReviewResponse {
  Review review = 1;
}

message CreateReplyRequest {
  int32 review_id = 1;
  string reply = 2;
  string user_id = 3;
}

message CreateReplyResponse {
  ReviewReply reply = 1;
}

message UpdateReviewRequest {
  int32 review_id = 1;
  string user_id = 2;
  int32 rating = 3;
  string comment = 4;
  optional farmera.common.StringList image_urls = 5;
  optional farmera.common.StringList video_urls = 6;
}

message UpdateReviewResponse {
  Review review = 1;
}

message UpdateReplyRequest {
  int32 reply_id = 1;
  string user_id = 2;
  string reply = 3;
}

message UpdateReplyResponse {
  ReviewReply reply = 1;
}

message DeleteReviewRequest {
  int32 review_id = 1;
  string user_id = 2;
}

message DeleteReviewResponse {
  bool success = 1;
}

message DeleteReplyRequest {
  int32 reply_id = 1;
  string user_id = 2;
}

message DeleteReplyResponse {
  bool success = 1;
}

message ApproveReviewRequest {
  int32 review_id = 1;
  bool approved = 2;
}

message ApproveReviewResponse {
  bool success = 1;
}

// ========================================Process=======================================
// Product process tracking
message ProductProcess {
  int32 process_id = 1;
  int32 product_id = 2;
  string stage_name = 3;
  map<string, string> description = 4;
  repeated string image_urls = 5;
  optional farmera.common.StringList video_urls = 6;
  farmera.common.Timestamp start_date = 7;
  farmera.common.Timestamp end_date = 8;
  int32 latitude = 9;
  int32 longitude = 10;
  farmera.common.Timestamp created = 11;
}

message CreateProcessRequest {
  int32 product_id = 1;
  string stage_name = 2;
  map<string, string> description = 3;
  farmera.common.Timestamp start_date = 4;
  farmera.common.Timestamp end_date = 5;
  int32 latitude = 6;
  int32 longitude = 7;
  repeated string image_urls = 8;
  optional farmera.common.StringList video_urls = 9;
  string user_id = 10;
}

message CreateProcessResponse {
  ProductProcess process = 1;
}

message GetProcessRequest {
  int32 process_id = 1;
}

message GetProcessResponse {
  ProductProcess process = 1;
}

message ListProcessesRequest {
  farmera.common.SimpleCursorPaginationRequest pagination = 1;
  int32 product_id = 2;
}

message ListProcessesResponse {
  repeated ProductProcess processes = 1;
  farmera.common.SimpleCursorPaginationResponse pagination = 2;
}